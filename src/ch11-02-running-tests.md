## পরীক্ষাগুলো কীভাবে চালানো হয় তা নিয়ন্ত্রণ করা

ঠিক যেমন `cargo run` আপনার কোড কম্পাইল করে এবং তারপরে ফলস্বরূপ বাইনারি চালায়, `cargo test` আপনার কোডটি পরীক্ষা মোডে কম্পাইল করে এবং ফলস্বরূপ পরীক্ষার বাইনারি চালায়। `cargo test` দ্বারা উত্পাদিত বাইনারির ডিফল্ট আচরণ হল সমস্ত পরীক্ষা সমান্তরালভাবে চালানো এবং পরীক্ষা চালানোর সময় তৈরি করা আউটপুট ক্যাপচার করা, আউটপুট প্রদর্শিত হতে বাধা দেওয়া এবং পরীক্ষার ফলাফলের সাথে সম্পর্কিত আউটপুটটি পড়া সহজ করে তোলা। আপনি, তবে, এই ডিফল্ট আচরণ পরিবর্তন করার জন্য কমান্ড লাইন অপশন নির্দিষ্ট করতে পারেন।

কিছু কমান্ড লাইন অপশন `cargo test`-এ যায় এবং কিছু ফলস্বরূপ পরীক্ষার বাইনারিতে যায়। এই দুটি ধরনের আর্গুমেন্টকে আলাদা করতে, আপনি `cargo test`-এ যাওয়া আর্গুমেন্টগুলো তালিকাভুক্ত করেন তারপরে বিভাজক `--` এবং তারপর যেগুলো পরীক্ষার বাইনারিতে যায় সেগুলো তালিকাভুক্ত করেন। `cargo test --help` চালালে আপনি `cargo test`-এর সাথে ব্যবহার করতে পারেন এমন অপশনগুলো দেখায় এবং `cargo test -- --help` চালালে আপনি বিভাজকের পরে ব্যবহার করতে পারেন এমন অপশনগুলো দেখায়। সেই অপশনগুলো [rustc বইয়ের][rustc] [“পরীক্ষা” বিভাগে][tests] নথিভুক্ত করা হয়েছে।

[tests]: https://doc.rust-lang.org/rustc/tests/index.html
[rustc]: https://doc.rust-lang.org/rustc/index.html

### সমান্তরালভাবে বা ধারাবাহিকভাবে পরীক্ষা চালানো

আপনি যখন একাধিক পরীক্ষা চালান, ডিফল্টরূপে সেগুলো থ্রেড ব্যবহার করে সমান্তরালভাবে চলে, যার মানে তারা দ্রুত রান করা শেষ করে এবং আপনি দ্রুত প্রতিক্রিয়া পান। যেহেতু পরীক্ষাগুলো একই সময়ে চলছে, তাই আপনাকে নিশ্চিত করতে হবে যে আপনার পরীক্ষাগুলো একে অপরের উপর বা কোনো শেয়ার্ড অবস্থার উপর নির্ভর করে না, যার মধ্যে শেয়ার্ড পরিবেশ, যেমন বর্তমান কাজের ডিরেক্টরি বা এনভায়রনমেন্ট ভেরিয়েবল অন্তর্ভুক্ত।

উদাহরণস্বরূপ, ধরা যাক আপনার প্রতিটি পরীক্ষা কিছু কোড চালায় যা ডিস্কে _test-output.txt_ নামের একটি ফাইল তৈরি করে এবং সেই ফাইলে কিছু ডেটা লেখে। তারপর প্রতিটি পরীক্ষা সেই ফাইলের ডেটা পড়ে এবং দাবি করে যে ফাইলটিতে একটি বিশেষ ভ্যালু আছে, যা প্রতিটি পরীক্ষায় আলাদা। যেহেতু পরীক্ষাগুলো একই সময়ে চলে, একটি পরীক্ষা অন্য পরীক্ষার লেখার এবং ফাইলটি পড়ার মধ্যবর্তী সময়ে ফাইলটিকে ওভাররাইট করতে পারে। দ্বিতীয় পরীক্ষাটি তখন ব্যর্থ হবে, কারণ কোডটি ভুল হওয়ার কারণে নয় বরং সমান্তরালভাবে চলার সময় পরীক্ষাগুলো একে অপরের সাথে হস্তক্ষেপ করেছে। একটি সমাধান হল নিশ্চিত করা যে প্রতিটি পরীক্ষা একটি ভিন্ন ফাইলে লেখে; অন্য সমাধান হল একটি সময়ে একটি করে পরীক্ষা চালানো।

যদি আপনি পরীক্ষাগুলো সমান্তরালভাবে চালাতে না চান বা আপনি ব্যবহৃত থ্রেডের সংখ্যার উপর আরও সূক্ষ্ম নিয়ন্ত্রণ রাখতে চান, তবে আপনি `--test-threads` ফ্ল্যাগ এবং আপনি যে সংখ্যক থ্রেড ব্যবহার করতে চান তা পরীক্ষার বাইনারিতে পাঠাতে পারেন। নিম্নলিখিত উদাহরণটি দেখুন:

```console
$ cargo test -- --test-threads=1
```

আমরা পরীক্ষার থ্রেডের সংখ্যা `1`-এ সেট করেছি, প্রোগ্রামটিকে কোনো সমান্তরালতা ব্যবহার না করতে বলছি। একটি থ্রেড ব্যবহার করে পরীক্ষাগুলো চালানো সমান্তরালভাবে চালানোর চেয়ে বেশি সময় নেবে, তবে পরীক্ষাগুলো যদি অবস্থা শেয়ার করে তবে একে অপরের সাথে হস্তক্ষেপ করবে না।

### ফাংশনের আউটপুট দেখানো

ডিফল্টরূপে, যদি একটি পরীক্ষা পাস হয়, তবে রাস্টের পরীক্ষা লাইব্রেরি স্ট্যান্ডার্ড আউটপুটে যা প্রিন্ট করা হয়েছে তা ক্যাপচার করে। উদাহরণস্বরূপ, যদি আমরা একটি পরীক্ষায় `println!` কল করি এবং পরীক্ষাটি পাস হয়, তবে আমরা টার্মিনালে `println!` আউটপুটটি দেখতে পাব না; আমরা শুধুমাত্র সেই লাইনটি দেখতে পাব যা নির্দেশ করে যে পরীক্ষাটি পাস হয়েছে। যদি একটি পরীক্ষা ব্যর্থ হয়, তাহলে আমরা ব্যর্থতার বার্তার বাকি অংশের সাথে স্ট্যান্ডার্ড আউটপুটে যা প্রিন্ট করা হয়েছে তা দেখতে পাব।

উদাহরণস্বরূপ, Listing 11-10-এ একটি বোকা ফাংশন রয়েছে যা এর প্যারামিটারের ভ্যালু প্রিন্ট করে এবং 10 রিটার্ন করে, সেইসাথে একটি পরীক্ষা যা পাস হয় এবং একটি পরীক্ষা যা ব্যর্থ হয়।

<Listing number="11-10" file-name="src/lib.rs" caption="একটি ফাংশনের জন্য পরীক্ষা যা `println!` কল করে">

```rust,panics,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-10/src/lib.rs}}
```

</Listing>

যখন আমরা `cargo test` দিয়ে এই পরীক্ষাগুলো চালাই, তখন আমরা নিম্নলিখিত আউটপুটটি দেখতে পাব:

```console
{{#include ../listings/ch11-writing-automated-tests/listing-11-10/output.txt}}
```

লক্ষ্য করুন যে এই আউটপুটের কোথাও আমরা `I got the value 4` দেখতে পাই না, যা পাস হওয়া পরীক্ষাটি চলার সময় প্রিন্ট হয়। সেই আউটপুটটি ক্যাপচার করা হয়েছে। যে পরীক্ষাটি ব্যর্থ হয়েছে, `I got the value 8`-এর আউটপুট পরীক্ষার সারাংশের আউটপুট অংশে প্রদর্শিত হয়, যা পরীক্ষার ব্যর্থতার কারণও দেখায়।

যদি আমরা পাস হওয়া পরীক্ষাগুলোর জন্য প্রিন্ট করা ভ্যালুগুলোও দেখতে চাই, তাহলে আমরা রাস্টকে `--show-output` দিয়ে সফল পরীক্ষাগুলোর আউটপুটও দেখাতে বলতে পারি:

```console
$ cargo test -- --show-output
```

যখন আমরা `--show-output` ফ্ল্যাগ দিয়ে Listing 11-10-এর পরীক্ষাগুলো আবার চালাই, তখন আমরা নিম্নলিখিত আউটপুটটি দেখতে পাই:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-01-show-output/output.txt}}
```

### নাম দিয়ে পরীক্ষার একটি উপসেট চালানো

মাঝে মাঝে, একটি সম্পূর্ণ পরীক্ষা স্যুট চালাতে অনেক সময় লাগতে পারে। যদি আপনি কোনো নির্দিষ্ট এলাকায় কোড নিয়ে কাজ করেন, তবে আপনি সেই কোডের সাথে সম্পর্কিত পরীক্ষাগুলোই শুধুমাত্র চালাতে চাইতে পারেন। আপনি `cargo test`-এ আর্গুমেন্ট হিসাবে আপনি যে পরীক্ষা(গুলো) চালাতে চান সেগুলোর নাম বা নামগুলো পাস করে কোন পরীক্ষাগুলো চালাতে হবে তা বেছে নিতে পারেন।

কিভাবে পরীক্ষার একটি উপসেট চালাতে হয় তা দেখানোর জন্য, আমরা প্রথমে Listing 11-11-এ দেখানো হিসাবে আমাদের `add_two` ফাংশনের জন্য তিনটি পরীক্ষা তৈরি করব এবং কোনটি চালাতে হবে তা বেছে নেব।

<Listing number="11-11" file-name="src/lib.rs" caption="তিনটি ভিন্ন নাম সহ তিনটি পরীক্ষা">

```rust,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/listing-11-11/src/lib.rs}}
```

</Listing>

যদি আমরা কোনো আর্গুমেন্ট পাস না করে পরীক্ষাগুলো চালাই, যেমনটি আমরা আগে দেখেছি, তাহলে সমস্ত পরীক্ষা সমান্তরালভাবে চলবে:

```console
{{#include ../listings/ch11-writing-automated-tests/listing-11-11/output.txt}}
```

#### একক পরীক্ষা চালানো

আমরা শুধুমাত্র সেই পরীক্ষাটি চালানোর জন্য `cargo test`-এ যেকোনো পরীক্ষা ফাংশনের নাম পাস করতে পারি:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-02-single-test/output.txt}}
```

শুধুমাত্র `one_hundred` নামের পরীক্ষাটি চলেছে; অন্য দুটি পরীক্ষা সেই নামের সাথে মেলেনি। পরীক্ষার আউটপুটটি আমাদের জানায় যে আমাদের আরও পরীক্ষা ছিল যা শেষে `2 filtered out` দেখিয়ে চলেনি।

আমরা এইভাবে একাধিক পরীক্ষার নাম উল্লেখ করতে পারি না; `cargo test`-এ দেওয়া প্রথম ভ্যালুটি শুধুমাত্র ব্যবহার করা হবে। তবে একাধিক পরীক্ষা চালানোর একটি উপায় রয়েছে।

#### একাধিক পরীক্ষা চালানোর জন্য ফিল্টারিং

আমরা একটি পরীক্ষার নামের অংশ নির্দিষ্ট করতে পারি এবং সেই ভ্যালুর সাথে মেলে এমন যেকোনো পরীক্ষা চালানো হবে। উদাহরণস্বরূপ, যেহেতু আমাদের দুটি পরীক্ষার নামে `add` রয়েছে, তাই আমরা `cargo test add` চালিয়ে সেই দুটি চালাতে পারি:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-03-multiple-tests/output.txt}}
```

এই কমান্ডটি নামে `add` আছে এমন সমস্ত পরীক্ষা চালায় এবং `one_hundred` নামের পরীক্ষাটি ফিল্টার করে বাদ দেয়। এছাড়াও মনে রাখবেন যে একটি পরীক্ষা যে মডিউলে প্রদর্শিত হয় সেটি পরীক্ষার নামের অংশ হয়ে যায়, তাই আমরা মডিউলের নামের উপর ফিল্টার করে একটি মডিউলের সমস্ত পরীক্ষা চালাতে পারি।

### বিশেষভাবে অনুরোধ না করা পর্যন্ত কিছু পরীক্ষা উপেক্ষা করা

মাঝে মাঝে কিছু নির্দিষ্ট পরীক্ষা কার্যকর করতে খুব বেশি সময় লাগতে পারে, তাই আপনি `cargo test` চালানোর বেশিরভাগ সময়ে সেগুলো বাদ দিতে চাইতে পারেন। আপনি যে পরীক্ষাগুলো চালাতে চান সেগুলো আর্গুমেন্ট হিসাবে তালিকাভুক্ত করার পরিবর্তে, আপনি সেগুলোকে বাদ দেওয়ার জন্য `ignore` অ্যাট্রিবিউট ব্যবহার করে সময়সাপেক্ষ পরীক্ষাগুলোতে টীকা দিতে পারেন, যেমনটি এখানে দেখানো হয়েছে:

<span class="filename">Filename: src/lib.rs</span>

```rust,noplayground
{{#rustdoc_include ../listings/ch11-writing-automated-tests/no-listing-11-ignore-a-test/src/lib.rs:here}}
```

`#[test]`-এর পরে, আমরা যে পরীক্ষাটি বাদ দিতে চাই তার সাথে `#[ignore]` লাইনটি যোগ করি। এখন যখন আমরা আমাদের পরীক্ষাগুলো চালাই, `it_works` চলে, কিন্তু `expensive_test` চলে না:

```console
{{#include ../listings/ch11-writing-automated-tests/no-listing-11-ignore-a-test/output.txt}}
```

`expensive_test` ফাংশনটিকে `ignored` হিসাবে তালিকাভুক্ত করা হয়েছে। যদি আমরা শুধুমাত্র উপেক্ষা করা পরীক্ষাগুলো চালাতে চাই, তাহলে আমরা `cargo test -- --ignored` ব্যবহার করতে পারি:

```console
{{#include ../listings/ch11-writing-automated-tests/output-only-04-running-ignored/output.txt}}
```

কোন পরীক্ষাগুলো চলবে তা নিয়ন্ত্রণ করে, আপনি নিশ্চিত করতে পারেন যে আপনার `cargo test`-এর ফলাফল দ্রুত ফিরে আসবে। যখন আপনি এমন একটি অবস্থানে থাকেন যেখানে `ignored` পরীক্ষাগুলোর ফলাফল পরীক্ষা করা বোধগম্য হয় এবং আপনার কাছে ফলাফলের জন্য অপেক্ষা করার সময় থাকে, তখন আপনি পরিবর্তে `cargo test -- --ignored` চালাতে পারেন। যদি আপনি সমস্ত পরীক্ষা চালাতে চান তা তারা উপেক্ষা করা হোক বা না হোক, তাহলে আপনি `cargo test -- --include-ignored` চালাতে পারেন।
